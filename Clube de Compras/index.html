<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clube de Compras | São Paulo Tech School</title>
  </head>

  <body>

    <!-- Enunciado -->
     <!-- 
    Clube de Compras da SPorTech
A loja de artigos esportivos SPorTech quer implementar um sistema de cadastro para seus clientes, oferecendo descontos especiais em compras futuras. 

Para se cadastrar, o cliente deve informar um nome de usuário e uma senha, recebendo a informação de qual grupo o usuário pertencerá.

Para realizar seu login, deve informar o nome de usuário e senha cadastradas, além de informar o grupo.

Caso as informações estejam corretas, o usuário pode acessar a aplicação para obter descontos na plataforma de acordo com seu perfil. 



Parte 1 - Cadastro:
O sistema precisa verificar e validar esses dados conforme as seguintes regras:

Nome de Usuário:

O nome de usuário não pode conter espaços nem os seguintes caracteres especiais: !, @, #, $, % e &.
Caso o nome de usuário contenha algum desses caracteres ou tenha espaço, o sistema exibirá uma mensagem de erro indicando "Nome de usuário inválido. Verifique os caracteres utilizados.".

Senha:

A senha deve conter pelo menos oito caracteres, incluindo:
Um caractere especial (!, @, #, $, % ou &.).
Uma letra maiúscula.
Uma letra minúscula.
Um número.
Caso a senha não atenda a esses requisitos, o sistema exibirá uma mensagem de erro correspondente, como "A senha deve conter no mínimo 8 caracteres, com ao menos um caractere especial, uma letra maiúscula, uma letra minúscula e um número.".

Cadastro e Grupo:

Ao clicar no botão "Cadastrar", caso passe pelas validações, o sistema atribui ao cliente um número aleatório de 1 a 4 para definir o grupo ao qual ele pertence, representando um benefício:
CÓDIGO 1 - Grupo Ouro: Desconto de 20% em todas as compras.
CÓDIGO 2 - Grupo Prata: Desconto de 15% em todas as compras.
CÓDIGO 3 - Grupo Bronze: Desconto de 10% em todas as compras.
CÓDIGO 4 - Grupo Cobre: Desconto de 5% em todas as compras.
Exiba uma mensagem de confirmação do cadastro junto com o grupo de benefício sorteado para o cliente.

Parte 2 - Login:
Depois de realizar o cadastro e exibir as informações do usuário, limpe os campos "nome do usuário" e "senha", adicione o campo "Grupo" e altere o botão "Cadastrar" pelo botão "Acessar Clube". 

Ao clicar no botão "Acessar", deve prosseguir somente caso o usuário, a senha e o grupo correspondem às informações cadastradas na Parte 1 - Cadastro. Caso contrário, deve exibir uma mensagem de alerta com "Login Inválido! Informações não correspondem.".



Parte 3 - Compra:
Depois de realizar o login, o cliente pode realizar uma compra na loja. O sistema deve:

Remover a exibição de todos os campos e botões;
Gerar um número aleatório representando a quantidade de produtos que o cliente deseja comprar (entre 1 e 10).
Gerar um número aleatório para o preço médio de cada produto (entre R$10,00 e R$100,00).
Calcular o valor total da compra multiplicando a quantidade de produtos pelo preço médio de cada um.
Aplicar o desconto correspondente ao grupo ao qual o cliente pertence, de acordo com a tabela de benefícios.
Calcular o valor final da compra após o desconto.
Ao final, o sistema deve exibir um extrato da compra com as seguintes informações:

Quantidade de produtos.
Preço médio de cada produto.
Valor original da compra.
Percentual e valor do desconto aplicado.
Valor final a ser pago.

Exemplo de Funcionamento:
Cadastro:

O cliente informa o usuário “Esportista123” e senha “Segura@2023”.
Se os dados atenderem aos critérios, o cadastro é aceito, e o sistema atribui um grupo, por exemplo, "Grupo Ouro".
Exibe a mensagem:

Cadastrado Concluído!
--------------------------------
usuário: testeuser
senha: Teste123#
código do grupo: 1
descrição: Grupo Ouro

Compra:
O  sistema gera uma quantidade de 5 produtos e um preço médio de R$50,00.
O valor total da compra é R$250,00 (5 x 50).
O sistema calcula o desconto de 20% e aplica na compra, resultando em R$200,00 a serem pagos.
Exibe o extrato na página:

Extrato de Compra
------------------------
Quantidade de produtos: 5
Preço médio por produto: R$50,00
Valor original: R$250,00
Desconto: 20% (-R$50,00)
Valor final: R$200,00


Observações:
1. Os valores monetários devem sempre ser exibidos com 2 casas decimais.
2. Para validar se na senha existem caracteres maiúsculos e minúsculos, utilize ".toUpperCase()" e ".toLowerCase()" para comparar com o valor originalmente inserido.
3. Para a parte da compra, todos os valores de quantidade e preço serão gerados aleatoriamente, para depois você calcular o total.
4. Para ocultar algum elemento através do JS, você pode utilizar o .innerHTML para manipular seu conteúdo ou o comando id_elemento.style.display = "none" para manipular a sua estilização do display. Para exibir o elemento novamente, altere o valor para um display válido ("block", "flex", etc.);
     -->
    <div id="div_opcao">
      <h1>Bem-vindo ao SPorTech</h1>
      <p>
        A SPorTech é uma loja de artigos esportivos que oferece descontos
        especiais!
      </p>
      <button id="btn_tela_cadastro" onclick="exibirTelas(div_cadastro)">
        Quero me cadastrar!
      </button>
      <button id="btn_tela_login" onclick="exibirTelas(div_login)">
        Já possuo cadastro. Quero logar
      </button>
    </div>

    <div id="div_cadastro" style="display: none">
      <h1>Cadastro</h1>
      <p>Informe seu nome de usuário</p>
      <input type="text" id="ipt_nome_cad" />
      <p>Informe uma nova senha</p>
      <input type="password" id="ipt_senha_cad" />
      <br /><br />
      <button onclick="voltar(div_opcao)">Voltar</button>
      <button onclick="cadastrar()">Cadastrar</button>
      <div id="div_mensagem_cadastro"></div>
    </div>

    <div id="div_login" style="display: none">
      <h1>Login</h1>
      <p>Informe seu nome de usuário</p>
      <input type="text" id="ipt_nome_login" />
      <p>Informe sua senha</p>
      <input type="password" id="ipt_senha_login" />
      <p>Informe seu grupo:</p>
      <input type="text" id="ipt_grupo" />
      <br /><br />
      <button onclick="voltar(div_opcao)">Voltar</button>
      <button onclick="logar()">Acessar Grupo</button>
    </div>

    <div id="div_compras" style="display: none">
      <h1>Compras</h1>
      <div id="div_carrinho"></div>
    </div>
  </body>
</html>

<script>
  var lista_nome_cadastro = [];
  var lista_senha_cadastro = [];
  var lista_descricao_cadastro = [];
  var lista_valor_medio_compra = [];
  var lista_quantidade_de_itens = [];

  function exibirTelas(id_da_tela) {
    id_da_tela.style.display = "flex";

    if (id_da_tela == div_cadastro) {
      div_opcao.style.display = "none";
      div_login.style.display = "none";
    } else if (id_da_tela == div_login) {
      div_opcao.style.display = "none";
      div_cadastro.style.display = "none";
    }
  }

  function voltar(primeira_tela) {
    primeira_tela.style.display = "flex";
    var mensagem = document.getElementById("div_mensagem_cadastro");

    div_cadastro.style.display = "none";
    div_login.style.display = "none";
    document.getElementById("ipt_nome_cad").value = "";
    document.getElementById("ipt_senha_cad").value = "";
    mensagem.style.display = "none";
  }

  function cadastrar() {
    var nome = document.getElementById("ipt_nome_cad").value;
    var senha = document.getElementById("ipt_senha_cad").value;
    var sorteio_grupo = Number((Math.random() * 3 + 1).toFixed());
    var sorteio_qtd_itens = Number((Math.random() * 9 + 1).toFixed());
    var sorteio_preco_medio = Number((Math.random() * 99 + 1).toFixed());
    var descricao;

    if (sorteio_grupo == 1) {
      descricao = "Grupo Ouro";
    } else if (sorteio_grupo == 2) {
      descricao = "Grupo Prata";
    } else if (sorteio_grupo == 3) {
      descricao = "Grupo Bronze";
    } else if (sorteio_grupo == 4) {
      descricao = "Grupo Cobre";
    }
    console.log(nome);
    console.log(senha);

    if (
      nome.indexOf(" ") != -1 ||
      nome.includes("!", "@", "#", "$", "%", "&")
    ) {
      alert(
        "Nome de usuário inválido! O nome de usuário não pode conter espaços nem os seguintes caracteres especiais: !, @, #, $, %, & e espaços."
      );
    } else if (
      senha.length < 8 ||
      !senha.includes("!", "@", "#", "$", "%", "&") ||
      senha.indexOf(" ") != -1 ||
      senha == senha.toUpperCase() ||
      senha == senha.toLowerCase()
    ) {
      alert(
        "Senha inválida! O senha deve ser maior que 8 dígitos e conter algum dos seguintes caracteres especiais: !, @, #, $, %, &, uma letra maiúscula, uma letra minúscula e um número. A senha não pode conter caracteres em branco"
      );
    } else if (lista_nome_cadastro.indexOf(nome) != -1) {
      alert(
        "Já existe um usuário com este nome em uso. Por favor, crie ou nome de usuário!"
      );
    } else {
      lista_nome_cadastro.push(nome);
      lista_senha_cadastro.push(senha);
      lista_descricao_cadastro.push(descricao);
      lista_quantidade_de_itens.push(sorteio_qtd_itens);
      lista_valor_medio_compra.push(sorteio_preco_medio);

      div_mensagem_cadastro.innerHTML = `
            <p>Cadastrado Concluído!</p>
            <hr id='id_pontilhados'>
            Usuário: ${lista_nome_cadastro[lista_nome_cadastro.length - 1]}<br>
            Senha: ${lista_senha_cadastro[lista_senha_cadastro.length - 1]}<br>
            Código do grupo: ${sorteio_grupo}<br>
            Descrição: ${
              lista_descricao_cadastro[lista_descricao_cadastro.length - 1]
            }
            `;

      div_mensagem_cadastro.style.display = "block";
    }
  }

  function logar() {
    var nome = document.getElementById("ipt_nome_login").value;
    var senha = document.getElementById("ipt_senha_login").value;
    var grupo = document.getElementById("ipt_grupo").value;
    var identificao = lista_nome_cadastro.indexOf(nome);

    if (
      lista_nome_cadastro.indexOf(nome) == -1 ||
      senha != lista_senha_cadastro[lista_nome_cadastro.indexOf(nome)] ||
      grupo != lista_descricao_cadastro[lista_nome_cadastro.indexOf(nome)]
    ) {
      alert("Login Inválido! Informações não correspondem.");
    } else {
      var qtd_produtos = Number(lista_quantidade_de_itens[identificao]);
      var preco_medio = Number(lista_valor_medio_compra[identificao]);
      var valor_original = qtd_produtos * preco_medio;
      var desconto;

      if (lista_descricao_cadastro[identificao] == "Grupo Ouro") {
        desconto = 0.2;
      } else if (lista_descricao_cadastro[identificao] == "Grupo Prata") {
        desconto = 0.15;
      } else if (lista_descricao_cadastro[identificao] == "Grupo Bronze") {
        desconto = 0.1;
      } else if (lista_descricao_cadastro[identificao] == "Grupo Cobre") {
        desconto = 0.05;
      }

      var valor_abatido = (valor_original * desconto).toFixed(2);
      var porcentagem = desconto * 100;
      var calculo_final = (
        valor_original *
        ((100 - porcentagem) / 100)
      ).toFixed(2);

      div_login.style.display = "none";
      div_compras.style.display = "flex";

      div_carrinho.innerHTML = `
            <p>Seu carrinho</p>
            <hr id='id_pontilhados'>
            Quantidade de produtos: ${qtd_produtos}<br>
            Preço médio por produto: R$${preco_medio.toFixed(2)}<br>
            Valor original: R$${valor_original}<br>
            Desconto: ${porcentagem}% (-R$${valor_abatido})<br>
            Valor final: R$${calculo_final}<br><br>
            <button onclick='inicio()'>Voltar ao início</button>
      `;
    }
  }

  function inicio() {
    div_compras.style.display = "none";
    div_opcao.style.display = "flex";
  }
</script>

<style>
  body {
    font-family: Arial, Helvetica, sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    padding: 0;
  }

  button {
    background-color: dodgerblue;
    padding: 1rem 2rem;
    border: none;
    border-radius: 0.2rem;
    color: white;
    cursor: pointer;
    opacity: 0.8;
    transition: opacity 0.4s;
    margin: 0 1rem 1rem 1rem;
    font-size: larger;
  }

  button:hover {
    opacity: 1;
  }

  #div_opcao,
  #div_cadastro,
  #div_login,
  #div_compras {
    border: solid thin gainsboro;
    border-radius: 0.5rem;
    display: flex;
    flex-direction: column;
    width: 40vw;
  }

  input {
    height: 2rem;
    margin: 0 1rem;
    font-size: large;
    text-align: center;
  }

  p,
  h1 {
    margin: 1rem 1rem;
    text-align: center;
  }

  hr {
    border: solid thin;
    border-color: gainsboro;
    border-style: dashed;
  }

  #div_mensagem_cadastro,
  #div_carrinho {
    text-align: center;
    margin: 1rem;
  }
</style>
